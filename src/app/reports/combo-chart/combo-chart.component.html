<ngx-charts-chart
  [view]="[width, height]"
  [showLegend]="true"
  [legendOptions]="legendOptions"
  [activeEntries]="activeEntries"
  [animations]="animations"
  (legendLabelActivate)="onActivate($event)"
  (legendLabelDeactivate)="onDeactivate($event)"
  (legendLabelClick)="onClick($event)">
  <svg:g [attr.transform]="transform" class="bar-chart chart">
    <svg:g ngx-charts-x-axis
      [xScale]="xScale"
      [dims]="dims"
      [showLabel]="true"
      [labelText]="xAxisLabel"
      [trimTicks]="false"
      [tickFormatting]="xAxisTickFormatting"
      [ticks]="xAxisTicks"
      [xAxisOffset]="dataLabelMaxHeight.negative"
      (dimensionsChanged)="updateXAxisHeight($event)">
    </svg:g>
    <svg:g
      *ngFor="let group of scaledResults; let index = index; trackBy:trackBy"
      [@animationState]="'active'"
      [attr.transform]="groupTransform(group)">
      <svg:g app-series-vertical
        type="stacked"
        [xScale]="xScale"
        [yScale]="yScale"
        [activeEntries]="activeEntries"
        [colors]="colors"
        [series]="group.series"
        [dims]="dims"
        [gradient]="gradient"
        [seriesName]="group.name"
        [animations]="animations"
        (select)="onClick($event, group)"
        (activate)="onActivate($event, group)"
        (deactivate)="onDeactivate($event, group)"
        (dataLabelHeightChanged)="onDataLabelMaxHeightChanged($event, index)"
      />
    </svg:g>
  </svg:g>

  <svg:g [attr.transform]="halfBarTransform">
    <svg:g
      ngx-charts-tooltip-area
      [dims]="dims"
      [xSet]="xSet"
      [xScale]="xScale"
      [yScale]="yScale"
      [results]="lineResults"
      [colors]="colors"
      [tooltipDisabled]="false"
      [tooltipTemplate]="tooltipTemplate"
      (hover)="updateHoveredVertical($event)"
    />

    <svg:g *ngFor="let series of scaledLineResults">
      <svg:g app-line-series
        [data]="series"
        [colors]="colors"
        [xScale]="xScale"
        [yScale]="yScale"
        [dims]="dims"
      />
    </svg:g>

    <svg:g *ngFor="let series of scaledLineResults">
      <svg:g
        ngx-charts-circle-series
        [xScale]="xScale"
        [yScale]="yScale"
        [colors]="colors"
        [data]="series"
        [scaleType]="schemeType"
        [visibleValue]="hoveredVertical"
        [activeEntries]="activeEntries"
        (select)="onClick($event, series)"
        (activate)="onActivate($event)"
        (deactivate)="onDeactivate($event)"
      />
    </svg:g>
  </svg:g>
  
  <ng-template #tooltipTemplate let-model="model">
    
    <div class="area-tooltip-container">
      {{ formatDate(hoveredVertical) }}

      <div
        *ngFor="let tooltipItem of model"
        class="tooltip-item">
        <span
          class="tooltip-item-color"
          [style.background-color]="tooltipItem.color">
        </span>
        {{ tooltipItem.series }} • {{ tooltipItem.value | currency }}
      </div>
      <div class="tooltip-item">Hours spent</div>
      <div *ngFor="let taskTooltipItem of getHoveredBars()" class="tooltip-item">
        <span
          class="tooltip-item-color"
          [style.background-color]="colors.getColor(taskTooltipItem.name)">
        </span>
        {{ taskTooltipItem.name }} • {{ formatHours(taskTooltipItem.value) }}
      </div>
    </div>
  </ng-template>
  
</ngx-charts-chart>
